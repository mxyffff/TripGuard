{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="{% static 'css/nation.css' %}"/>
    <title>êµ­ê°€ ìƒì„¸ í˜ì´ì§€</title>
</head>
<body>
<!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… -->
<div class="container">
    <div class="top-bar">
        <div class="auth-buttons">
            {% if user.is_authenticated %}
                <button type="button" class="logout-button" id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
            {% else %}
                <a href="{% url 'users:login' %}">ë¡œê·¸ì¸</a>
                <a href="{% url 'users:signup' %}">íšŒì›ê°€ì…</a>
            {% endif %}
        </div>
    </div>
</div>

<!-- /*ë„¤ë¹„ê²Œì´ì…˜ ë°”*/ -->
<div class="navbar">
    <a href="{% url 'homePage' %}" class="logo">
        <img src="{% static 'assets/img/TripGuard.png' %}" alt="TripGuard ë¡œê³ ">
    </a>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="êµ­ê°€ëª…ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ:ì¤‘êµ­)">
        <button id="searchBtn" type="button"><img src="{% static 'assets/img/Search.png' %}" alt="ê²€ìƒ‰"></button>
    </div>
</div>

<!-- êµ­ê°€ëª… -->
<section class="nation-header">
    <h1 class="nation-title">ì¤‘êµ­</h1>
    <p class="nation-subtitle">china</p>
</section>

<div class="wrapper">
    <div class="container">
        <!-- ì§€ë„ ì„¹ì…˜ -->
        <section class="nation-map">
            <div class="level">
                <div><span class="dot blue"></span> ì—¬í–‰ìœ ì˜</div>
                <div><span class="dot yellow"></span> ì—¬í–‰ìì œ</div>
                <div><span class="dot red"></span> ì¶œêµ­ê¶Œê³ </div>
                <div><span class="dot black"></span> ì—¬í–‰ê¸ˆì§€</div>
                <div>
              <span class="dot exception">
                <img src="{% static 'assets/img/exception.png' %}" alt="íŠ¹ë³„ì—¬í–‰ì£¼ì˜ë³´"/>
              </span>
                    íŠ¹ë³„ì—¬í–‰ì£¼ì˜ë³´
                </div>
            </div>
            <img src="{% static 'assets/img/ChinaMap.svg' %}" alt="ì¤‘êµ­ ì§€ë„"/>
        </section>

        <!-- íƒ­ ì´ë™ -->
        <div class="tab-wrap">
            <nav class="tabs">
                <div class="select active" onclick="showTab('embassy', this)">ì¬ì™¸ê³µê´€</div>
                <div class="select" onclick="showTab('danger', this)">ìœ ì˜ì§€ì—­</div>
                <div class="select" onclick="showTab('review', this)">í›„ê¸°</div>
            </nav>

            <!-- ì¬ì™¸ê³µê´€ íƒ­ -->
            <section class="tab" id="embassy">
                <div id="embassy-cards"></div> <!-- ğŸ”§ JSë¡œ ì¹´ë“œ ìƒì„±ë  ì˜ì—­ -->
            </section>

            <!-- ìœ ì˜ì§€ì—­ íƒ­ -->
            <section class="tab" id="danger" style="display: none">
                <!-- JSê°€ ë‚´ë¶€ ë‚´ìš© ìƒì„± -->
            </section>

            <!-- í›„ê¸° íƒ­ -->
            <section class="tab" id="review" style="display: none">
                <div class="review-input">
                    <div class="user-info">
                        <img src="{% static 'assets/img/profile.svg' %}" alt="í”„ë¡œí•„" class="profile-img"/>
                        <div class="id"></div>
                        <img src="{% static 'assets/img/close.svg' %}" alt="ë‹«ê¸°" class="close-icon"/>
                    </div>
                    <div class="input-area">
                        <input type="text" id="review-input" placeholder="í•œ ì¤„ í›„ê¸°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."/>
                        <button id="review-submit" class="submit-btn">ë“±ë¡</button>
                    </div>
                </div>
                <div class="review-wrap">
                    <div class="review-list" id="review-list"></div>
                    <div class="overlay-message" id="login-required">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
                </div>
            </section>
        </div>
    </div>

    <!-- êµ­ê°€ ì •ë³´ + ê³µì§€ -->
    <div class="side-section">
        <section class="nation-info">
            <img src="{% static 'assets/img/china.png' %}" alt="ì¤‘êµ­ êµ­ê¸°" class="flag-img"/>
            <div class="info-text">
                <h4 class="subtitle">âœ…ê¸°ë³¸ì •ë³´</h4>
                <dl class="info-list">
                    <div class="info-item">
                        <dt>êµ­ê°€ëª…</dt>
                        <dd>ì¤‘êµ­(china)</dd>
                    </div>
                    <div class="info-item">
                        <dt>ìˆ˜ë„</dt>
                        <dd>ë² ì´ì§•</dd>
                    </div>
                    <div class="info-item">
                        <dt>ì–¸ì–´</dt>
                        <dd>ë³´í†µí™”</dd>
                    </div>
                    <div class="info-item">
                        <dt>í†µí™”</dt>
                        <dd>ìœ„ì•ˆ</dd>
                    </div>
                    <div class="info-item">
                        <dt>êµ­ì œì „í™”ë²ˆí˜¸</dt>
                        <dd>+86</dd>
                    </div>
                </dl>
            </div>
            <div class="source">[ì¶œì²˜:ì™¸êµë¶€]</div>
        </section>

        <section class="notice">
            <h4 class="subtitle">ì•ˆì „ê³µì§€</h4>
            <hr class="divider"/>
            <table class="notice-table">
                <!-- JSë¡œ <tr> ì‚½ì… -->
            </table>
        </section>
    </div>
</div>

<!-- í‘¸í„° -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-section left">
            <div class="project-title">ì„œìš¸ì—¬ëŒ€ ë©‹ì‚¬ ì—¬ê¸°í†¤ í† ì´ í”„ë¡œì íŠ¸</div>
            <div>4íŒ€ TripGuard</div>
        </div>
        <div class="footer-section">
            <strong>PM</strong>
            <div>ê¹€ì£¼ì•„</div>
        </div>
        <div class="footer-section">
            <strong>FE</strong>
            <div>ì†ì˜ˆì›</div>
            <div>ì£¼ì±„ë¹ˆ</div>
        </div>
        <div class="footer-section">
            <strong>BE</strong>
            <div>ì–‘ë³´ìœ¤</div>
            <div>ì´ë‹¤ê²¸</div>
            <div>ë°•ì±„ë¦°</div>
        </div>
    </div>
    <div class="footer-line"></div>
    <div class="footer-copy">Â© 2025 TripGuard. All rights reserved.</div>
</footer>

<script src="{% static 'nation.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("searchBtn");
        const input = document.getElementById("searchInput");

        function handleSearch() {
            const keyword = input.value.trim();
            if (keyword === "ì¤‘êµ­") {
                window.location.href = "/nation/";
            } else {
                window.location.href = "/cantFind/";
            }
        }

        // 1. ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ìƒ‰
        if (btn) {
            btn.addEventListener("click", handleSearch);
        }

        // 2. ì—”í„° í‚¤ ì…ë ¥ ì‹œ ê²€ìƒ‰
        if (input) {
            input.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    handleSearch();
                }
            });
        }

        const logoutBtn = document.getElementById("logout-btn");

        if (logoutBtn) {
            logoutBtn.addEventListener("click", async () => {
                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

                const res = await fetch("/auth/logout/", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": csrfToken,
                    },
                    credentials: "include",
                });

                if (res.ok) {
                    // ê·¸ëƒ¥ í˜„ì¬ í˜ì´ì§€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ ì„¸ì…˜ë§Œ ê°±ì‹ !
                    window.location.reload();
                } else {
                    alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨");
                }
            });
        }
    });
</script>
</body>
</html>